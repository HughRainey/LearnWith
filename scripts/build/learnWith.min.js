angular.module("learnWith",["ngRoute","ui.grid","ui.grid.selection","ui.grid.resizeColumns","ui.bootstrap"]),angular.module("learnWith").controller("LoginCtrl",["$scope","AuthenticationService","UserModel","$location",function(e,t,a,r){e.title="Login View",e.userModel=a,console.log(e.userModel),e.usernameError="",e.passwordError="",e.onReset=function(){e.userModel.user.username="",e.userModel.user.password=""},e.onLogin=function(){var a=!1;""==e.userModel.user.username?(e.usernameError="You Must Enter a Username",a=!0):e.usernameError="",""==e.userModel.user.password?(e.passwordError="You Must Enter a Password",a=!0):e.passwordError="",1!=a&&t.authenticate(e.userModel.user.username,e.userModel.user.password).then(d,s)};var s=function(e){console.log("failure"),console.log(e),alert(e.data)},d=function(t){return 1==t.data.error?void alert("We could not log you in"):(e.userModel.user=t.data.resultObject,void r.path("/tasks"))};e.onLoginAsMe=function(){console.log("login as me"),e.userModel.user.username="me",e.userModel.user.password="me",e.onLogin()},e.onLoginAsWife=function(){console.log("login as wife"),e.userModel.user.username="wife",e.userModel.user.password="wife",e.onLogin()}}]),angular.module("learnWith").controller("MainScreenCtrl",["$scope","$location","$filter","$timeout","$uibModal","UserModel","TaskModel","TaskService",function(e,t,a,r,s,d,o,l){function n(e,t,a){l.loadTasks(e).then(t,a)}function i(e){console.log(e.data),alert(e.data)}function u(t){return 1==t.data.error?(console.log("we could load the task data"),void alert("We could not load the task data")):void(e.taskModelWrapper.taskModel.tasks=t.data.resultObject)}function c(){l.loadTaskCategories().then(k,i)}function k(t){return 1==t.data.error?(console.log("we could load the task categories"),void alert("We could not load the task categories")):void(e.taskModelWrapper.taskModel.taskCategories=t.data.resultObject)}function p(e,t){var a=s.open({templateUrl:"com/dotComIt/learnWith/views/tasks/TaskCU.html",controller:"TaskCUCtrl",resolve:{title:function(){return e},taskVO:function(){return t}}}),r=updateTaskComplete;0==t.taskID&&(r=C),a.result.then(r,h)}function h(){console.log("Modal dismissed at: "+new Date)}function C(e){o.tasks.push(e)}function D(){console.log("load scheduler tasks placeholder");var t={};t.scheduledEqualDate=a("date")(e.scheduler.schedulerDate,"shortDate"),n(t,m,i)}function m(e){return 1==e.data.error?void alert("We could not load the task data"):(o.scheduledTasks=e.data.resultObject,void(o.scheduledTasks=o.scheduledTasks.concat(o.addedTasks)))}function g(e){var t=o.scheduledTasks.indexOf(e);t>=0&&o.scheduledTasks.splice(t,1),t=o.addedTasks.indexOf(e),t>=0&&o.addedTasks.splice(t,1)}function f(e){l.scheduleTask(e).then(I,y)}function y(e){alert(e.data)}function I(e){if(1==e.data.error)return void alert("We could not schedule the task data");for(M(o.tasks,e.data.resultObject[0]),index=0;index<o.scheduledTasks.length;++index)o.scheduledTasks[index].taskID==e.data.resultObject[0].taskID&&g(o.scheduledTasks[index])}function M(e,t){for(index=0;index<e.length;++index)if(e[index].taskID==t.taskID){e[index]=t;break}}function T(e){alert(e.data)}function v(t){if(1==t.data.error)return void alert("We could not schedule the tasks");for(var r=0;r<o.tasks.length;++r)for(scheduledTaskIndex=0;scheduledTaskIndex<o.scheduledTasks.length;scheduledTaskIndex++)o.tasks[r].taskID==o.scheduledTasks[scheduledTaskIndex].taskID&&(o.tasks[r].dateScheduled=a("date")(e.scheduler.schedulerDate,"M/d/yyyy"));o.addedTasks=[]}function S(e,t,a,r){alert(e)}function b(t,a,r,s){return 1==t.error?void alert("We could not load the task data"):void M(e.tasksModel.tasksModel.tasks,t.resultObject[0])}function w(){d.validateUser()?(n(e.taskModelWrapper.taskModel.taskFilter,u,i),c()):t.path("/login"),d.isUserInRole(d.CREATOR_ROLE)?(e.gridContainerStyle="horizontal-layout-100",e.taskGridOptions.columnDefs=O):e.taskGridOptions.columnDefs=W}e.title="Main View",e.taskModelWrapper={taskModel:o},e.userModelWrapper={userModel:d},e.gridContainerStyle="horizontal-layout-94",e.schedulerShowButtonLabel="<",e.scheduler={schedulerState:!1,schedulerDate:new Date},e.taskGridOptions={data:"taskModelWrapper.taskModel.tasks",enableFullRowSelection:!0,enableRowHeaderSelection:!1,multiSelect:!1};var W=[{field:"completed",displayName:"Completed",cellTemplate:"com/dotComIt/learnWith/views/tasks/CompletedCheckBoxRenderer.html"},{field:"description",displayName:"Description"},{field:"taskCategory",displayName:"Category"},{field:"dateCreated",displayName:"Date Created"},{field:"dateScheduled",displayName:"Date Scheduled"},{name:"Controls",displayName:"",enableSorting:!1,cellTemplate:"com/dotComIt/learnWith/views/tasks/EditButtonRenderer.html"}],O=[{field:"completed",displayName:"Completed",cellTemplate:"com/dotComIt/learnWith/views/tasks/CompletedCheckBoxRenderer.html"},{field:"description",displayName:"Description"},{field:"taskCategory",displayName:"Category"},{field:"dateCreated",displayName:"Date Created"},{field:"dateScheduled",displayName:"Date Scheduled"}];e.dateOptions={startingDay:0,showWeeks:!1},e.createdAfterDateProperties={opened:!1},e.createdBeforeDateProperties={opened:!1},e.scheduledAfterDateProperties={opened:!1},e.scheduledBeforeDateProperties={opened:!1},e.currentDateProperties={opened:!1},e.openDatePicker=function(e){e.opened=!e.opened},e.taskGridOptions.onRegisterApi=function(t){console.log("in onRegisterApi"),t.selection.on.rowSelectionChanged(e,function(t){var a="row selected "+t.isSelected;console.log(a),t.isSelected?e.selectedItem=t.entity:e.selectedItem=null}),e.gridApi=t,r(function(){e.gridApi.core.handleWindowResize()},100)},e.onFilterRequest=function(){var t={};e.taskModelWrapper.taskModel.taskFilter.completed!=-1&&(t.completed=e.taskModelWrapper.taskModel.taskFilter.completed),t.taskCategoryID=e.taskModelWrapper.taskModel.taskFilter.taskCategoryID,e.taskModelWrapper.taskModel.taskFilter.startDate&&(t.startDate=a("date")(e.taskModelWrapper.taskModel.taskFilter.startDate,"shortDate")),e.taskModelWrapper.taskModel.taskFilter.endDate&&(t.endDate=a("date")(e.taskModelWrapper.taskModel.taskFilter.endDate,"shortDate")),e.taskModelWrapper.taskModel.taskFilter.scheduledStartDate&&(t.scheduledStartDate=a("date")(e.taskModelWrapper.taskModel.taskFilter.scheduledStartDate,"shortDate")),e.taskModelWrapper.taskModel.taskFilter.scheduledEndDate&&(t.scheduledEndDate=a("date")(e.taskModelWrapper.taskModel.taskFilter.scheduledEndDate,"shortDate")),n(t,u,i)},updateTaskComplete=function(e){for(index=0;index<o.tasks.length;++index)if(o.tasks[index].taskID==e.taskID){o.tasks[index]=e;break}},e.onNewTask=function(){var e={taskCategoryID:0,taskID:0};p("Create a New Task",e)},e.onEditTask=function(e){p("Edit Task",e)},e.onToggleScheduler=function(){1==e.scheduler.schedulerState?(e.scheduler.schedulerState=!1,e.gridContainerStyle="horizontal-layout-94",e.schedulerShowButtonLabel="<"):(e.scheduler.schedulerState=!0,e.gridContainerStyle="horizontal-layout-40",e.schedulerShowButtonLabel=">",D()),r(function(){e.gridApi.core.handleWindowResize()},1)},e.onSchedulerDateChange=function(){D()},e.onTaskUnschedule=function(e){e.dateScheduled?(e.dateScheduled=null,f(e)):g(e)},e.onScheduleTask=function(e){for(var t=!1,a=0;a<o.scheduledTasks.length;a++)if(o.scheduledTasks[a].taskID==e.taskID){t=!0;break}t||(o.scheduledTasks.push(e),o.addedTasks.push(e))},e.onTaskListSchedule=function(){l.scheduleTaskList(o.scheduledTasks,e.scheduler.schedulerDate).then(v,T)},e.onCompletedCheckBoxChange=function(e){l.completeTask(e,b,S)},w()}]),angular.module("learnWith").controller("TaskCUCtrl",["$scope","$uibModalInstance","TaskModel","UserModel","TaskService","title","taskVO",function(e,t,a,r,s,d,o){function l(e){alert(e.data)}function n(e){return 1==e.data.error?void alert("We could not create the task data"):void t.close(e.data.resultObject[0])}e.title=d,e.taskModel=a,e.taskVO=o,e.onSave=function(){console.log("on save"),s.updateTask(e.taskVO,r.user).then(n,l)},e.onClose=function(){t.dismiss()}}]),angular.module("learnWith").service("TaskModel",[function(){var e={addedTasks:[],scheduledTasks:[],taskCategories:[],taskCompletedOptions:[{id:-1,label:"All"},{id:0,label:"Open Tasks"},{id:1,label:"Completed Tasks"}],taskFilter:{completed:0,startDate:new Date("03/01/2016"),taskCategoryID:0},tasks:[]};return e}]),angular.module("learnWith").service("UserModel",[function(){function e(e){return a.user.role==e}function t(){return 0!=a.user.userID}var a={CREATOR_ROLE:2,isUserInRole:e,user:{userID:0,username:"",password:"",roleID:0},TASKER_ROLE:1,validateUser:t};return a}]),angular.module("learnWith").config(["$routeProvider",function(e){e.when("/login",{templateUrl:"com/dotComIt/learnWith/views/login/Login.html",controller:"LoginCtrl"}).when("/tasks",{templateUrl:"com/dotComIt/learnWith/views/tasks/MainScreen.html",controller:"MainScreenCtrl"}).otherwise({redirectTo:"/login"})}]),angular.module("learnWith").service("SharedUtils",["$filter",function(e){function t(t){var a="";for(var r in t)a+=t[r]instanceof Date?'"'+r+'":"'+e("date")(t[r],"MM/dd/yyyy")+'",':'"'+r+'":"'+t[r]+'",';return a.length>0&&(a=a.substr(0,a.length-1)),"{"+a+"}"}var a={objToJSONString:t};return a}]),angular.module("learnWith").service("AuthenticationService",["$q","$timeout",function(e,t){function a(a,r){var s=e.defer();return t(function(){var e={};"me"==a&&"me"==r?e.data={resultObject:{role:1,username:"me",userID:1},error:0}:"wife"==a&&"wife"==r?e.data={resultObject:{role:2,username:"wife",userID:2},error:0}:e.data={error:1},s.resolve(e)},1e3),s.promise}var r={authenticate:a};return r}]),angular.module("learnWith").service("TaskService",["$q","$timeout",function(e,t){function a(){var a=e.defer();return t(function(){var e={};e.data={resultObject:[{taskCategoryID:0,taskCategory:"All Categories"},{taskCategoryID:1,taskCategory:"Business"},{taskCategoryID:2,taskCategory:"Personal"}],error:!1},a.resolve(e)},1e3),a.promise}function r(a){var r=e.defer();return t(function(){var e=i.filter(function(e,t,r){if("undefined"!=typeof a.completed&&a.completed!=e.completed)return!1;if("undefined"!=typeof a.taskCategoryID&&0!=a.taskCategoryID&&a.taskCategoryID!=e.taskCategoryID)return!1;var s=new Date(e.dateCreated);if("undefined"!=typeof a.startDate){var d=new Date(a.startDate);if(d>s&&(d.getDate()!=s.getDate()||d.getMonth()!=s.getMonth()||d.getYear()!=s.getYear()))return!1}if("undefined"!=typeof a.endDate){var o=new Date(a.endDate);if(o<s)return!1}var l=new Date(e.dateScheduled);if("undefined"!=typeof a.scheduledStartDate){if(date1=new Date(a.scheduledStartDate),date1>l&&(date1.getDate()!=l.getDate()||date1.getMonth()!=l.getMonth()||date1.getYear()!=l.getYear()))return!1;if(""==e.dateScheduled)return!1}if("undefined"!=typeof a.scheduledEndDate){if(date1=new Date(a.scheduledEndDate),date1<l)return!1;if(""==e.dateScheduled)return!1}if("undefined"!=typeof a.scheduledEqualDate){if(date1=new Date(a.scheduledEqualDate),date1.getDate()!=l.getDate()||date1.getMonth()!=l.getMonth()||date1.getYear()!=l.getYear())return!1;if(""==e.dateScheduled)return!1}return!0}),t={};t.data={resultObject:e,error:0},r.resolve(t)},1e3),r.promise}function s(a,r){var s=e.defer();return t(function(){0==a.taskID&&(a.taskID=i[i.length-1].taskID+1,a.dateCreated=new Date,i.push(a)),1==a.taskCategoryID?a.taskCategory="Business":2==a.taskCategoryID?a.taskCategory="Personal":a.taskCategory="";var e={};e.data={resultObject:[a],error:0},s.resolve(e)},1e3),s.promise}function d(a){var r=e.defer();return t(function(){result={},result.data={resultObject:[a],error:0},r.resolve(result)},1e3),r.promise}function o(a,r){var s=e.defer();return t(function(){result={},result.data={error:0},s.resolve(result)},1e3),s.promise}function l(a){var r=e.defer();return t(function(){a.completed=!a.completed,result={},result.data={resultObject:[a],error:0},r.resolve(result)},1e3),r.promise}var n={loadTasks:r,loadTaskCategories:a,updateTask:s,scheduleTask:d,scheduleTaskList:o,completeTask:l},i=[{taskCategoryID:2,taskCategory:"Personal",description:"Get Milk",dateScheduled:"March, 29 2016 00:00:00",dateCompleted:"",taskID:1,dateCreated:"March, 27 2016 11:42:58",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"Finish Chapter 2",dateScheduled:"March, 29 2016 00:00:00",dateCompleted:"",taskID:2,dateCreated:"March, 28 2016 11:44:58",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"Plan Chapter 5",dateScheduled:"March, 20 2016 00:00:00",dateCompleted:"",taskID:5,dateCreated:"March, 28 2016 11:54:40",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"Write Code for Chapter 3",dateScheduled:"March, 29 2016 00:00:00",dateCompleted:"",taskID:3,dateCreated:"March, 29 2016 11:45:16",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"Write Chapter 4",dateScheduled:"March, 20 2016 00:00:00",dateCompleted:"",taskID:4,dateCreated:"March, 30 2016 11:54:26",completed:1,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"Learn JQuery",dateScheduled:"",dateCompleted:"",taskID:6,dateCreated:"March, 31 2016 16:00:23",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"created by Test Harness",dateScheduled:"November, 24 2016 00:00:00",dateCompleted:"",taskID:7,dateCreated:"May, 09 2016 17:18:00",completed:0,userID:1},{taskCategoryID:2,taskCategory:"Personal",description:"This is a test task",dateScheduled:"February, 11 2017 00:00:00",dateCompleted:"",taskID:8,dateCreated:"May, 09 2016 18:26:10",completed:0,userID:1},{taskCategoryID:2,taskCategory:"Personal",description:"This is a test task",dateScheduled:"November, 24 2016 00:00:00",dateCompleted:"",taskID:9,dateCreated:"May, 09 2016 18:26:28",completed:0,userID:1},{taskCategoryID:2,taskCategory:"Personal",description:"This is a test task",dateScheduled:"November, 21 2016 00:00:00",dateCompleted:"",taskID:10,dateCreated:"May, 09 2016 18:27:06",completed:0,userID:1},{taskCategoryID:2,taskCategory:"Personal",description:"Test Task",dateScheduled:"November, 24 2016 00:00:00",dateCompleted:"",taskID:11,dateCreated:"May, 09 2016 18:33:11",completed:1,userID:1},{taskCategoryID:2,taskCategory:"Personal",description:"Task Task 2",dateScheduled:"November, 22 2016 00:00:00",dateCompleted:"",taskID:12,dateCreated:"May, 09 2016 18:35:07",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"created by Test Harness",dateScheduled:"November, 22 2016 00:00:00",dateCompleted:"",taskID:13,dateCreated:"May, 14 2016 16:49:06",completed:0,userID:1},{taskCategoryID:2,taskCategory:"Personal",description:"New Task for Jeff",dateScheduled:"November, 22 2016 00:00:00",dateCompleted:"",taskID:14,dateCreated:"May, 27 2016 12:23:42",completed:0,userID:2},{taskCategoryID:2,taskCategory:"Personal",description:"New Task for Jeff 2",dateScheduled:"November, 22 2016 00:00:00",dateCompleted:"",taskID:15,dateCreated:"May, 27 2016 12:23:42",completed:0,userID:2},{taskCategoryID:1,taskCategory:"Business",description:"Some Text",dateScheduled:"",dateCompleted:"",taskID:16,dateCreated:"November, 13 2016 16:42:51",completed:0,userID:1},{taskCategoryID:"",taskCategory:"",description:"testoring",dateScheduled:"",dateCompleted:"",taskID:17,dateCreated:"November, 16 2016 12:56:10",completed:1,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"Testoring",dateScheduled:"",dateCompleted:"",taskID:18,dateCreated:"November, 16 2016 13:04:38",completed:0,userID:1},{taskCategoryID:2,taskCategory:"Personal",description:"Testoring 3",dateScheduled:"",dateCompleted:"",taskID:19,dateCreated:"November, 16 2016 13:06:11",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"Testoring 2",dateScheduled:"",dateCompleted:"",taskID:20,dateCreated:"November, 16 2016 13:06:49",completed:0,userID:1},{taskCategoryID:2,taskCategory:"Personal",description:"Testoring 4",dateScheduled:"",dateCompleted:"",taskID:21,dateCreated:"November, 16 2016 13:07:01",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"created by Test Harness",dateScheduled:"",dateCompleted:"",taskID:22,dateCreated:"December, 05 2016 11:50:51",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"created by Test Harness",dateScheduled:"",dateCompleted:"",taskID:23,dateCreated:"December, 05 2016 11:51:05",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"created by Test Harness",dateScheduled:"",dateCompleted:"",taskID:24,dateCreated:"December, 05 2016 11:54:26",completed:0,userID:1},{taskCategoryID:2,taskCategory:"Personal",description:"This is a test task",dateScheduled:"",dateCompleted:"",taskID:25,dateCreated:"December, 05 2016 11:54:37",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"created by Test Harness",dateScheduled:"",dateCompleted:"",taskID:26,dateCreated:"December, 05 2016 16:57:32",completed:1,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"created by Test Harness",dateScheduled:"",dateCompleted:"",taskID:27,dateCreated:"December, 05 2016 16:58:23",completed:0,userID:1},{taskCategoryID:2,taskCategory:"Personal",description:"This is a test task",dateScheduled:"",dateCompleted:"",taskID:28,dateCreated:"December, 05 2016 16:59:23",completed:0,userID:1},{taskCategoryID:1,taskCategory:"Business",description:"New Task 2",dateScheduled:"",dateCompleted:"",taskID:29,dateCreated:"December, 07 2016 11:03:19",completed:1,userID:0},{taskCategoryID:"",taskCategory:"",description:"test",dateScheduled:"",dateCompleted:"",taskID:30,dateCreated:"December, 12 2016 12:19:24",completed:1,userID:1},{taskCategoryID:"",taskCategory:"",description:"New Task 2 2017 Edit",dateScheduled:"",dateCompleted:"",taskID:31,dateCreated:"February, 11 2017 14:49:39",completed:0,userID:1}];return n}]);